<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}"/>

<title>Admin Panel</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }
    .image-view-container{
        display: flex;
        flex-direction: column;
        width: 60%;
    }
    .container {
        display: flex;
        height: 100vh;

    }

    #section1 {
        width: 80%;
        flex: 1;
        padding: 20px;
        background-color: #fff;
        border-right: 1px solid #ccc;
        box-sizing: border-box;
        overflow-y: auto; /* Enable scrolling if content exceeds container height */
    }

    .album-container {
        display: flex;
        flex-direction: column;
        width: 40%;
        min-width: 200px;
        margin-right: 20px;
    }

    .album-section {
        margin-bottom: 10px;
    }

    .album {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .album:hover {
        background-color: #f0f0f0;
    }

    .image-container {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        overflow-y: auto; /* Enable scrolling if content exceeds container height */
        justify-content: flex-start; /* Left-justify the items */
        align-items: flex-start; /* Top-align the items */
        align-content: flex-start; /* Top-align the items */
        gap: 5px;
    }

    .image-item {
        width: 120px; /* Set the desired width of each image tile */
        height: 120px; /* Set the desired height of each image tile */
        margin: 5px; /* Add a small margin between images */
        border: 1px solid #ccc;
        border-radius: 5px;
        /*overflow: hidden;*/
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .image-item img {
       width: 100%;
        height: 70%;
        object-fit: scale-down;
    }

    .image-info-bar {
        white-space: normal;
        padding: 5px;
        background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white background */
        text-align: center;
        font-size: 8px;
        width: 100%;
        height: 30%;
    }


    #section2 {
        width: 20%;
        flex: 1;
        padding: 20px;
        background-color: #fff;
        box-sizing: border-box;
        overflow-y: auto; /* Enable scrolling if content exceeds container height */
    }

    form {
        margin-bottom: 20px;
    }

    label {
        font-weight: bold;
    }

    button {
        padding: 8px 12px;
        background-color: #007BFF;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }
    .toolbar {
        background-color: #f8f8f8; /* Light gray background */
        padding: 10px;
        display: flex;
        justify-content: flex-start;
        width: 100%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle box shadow */
    }

    .toolbar-button {
        background-color: #007BFF; /* Apple's blue color */
        color: white;
        border: none;
        padding: 8px 16px;
        margin-right: 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .toolbar-button:hover {
        background-color: #0056b3; /* Darker blue on hover */
    }

    .toolbar-button:hover {
        background-color: #777;
    }
</style>
</head>
<body>
<div style="text-align: center;"> <h1>ADMIN PANEL</h1></div>
<div class="container">
    <div class="section" id="section1">
        <div id="albumFormContainer">
            <!-- You can add any form related to albums here if needed -->
        </div>
        <div id="albumContainer" class="album-container">
            <!-- Albums will be dynamically added here from the server -->
        </div>
    </div>
    <div class="image-view-container" id="imageView">
        <div class="toolbar">
            <form id="fileUploadForm" style="height: 1px">
                <input type="file" name="files[]" id="fileInput" multiple style="display: none;" onchange="uploadFile()" />
                <button type="button" class="toolbar-button" onclick="document.getElementById('fileInput').click()">Upload Files</button>
            </form>

            <button class="toolbar-button">Button 2</button>
            <button class="toolbar-button">Button 3</button>
        </div>

        <div class="image-container" id="imageContainer">
            <!-- Images will be dynamically added here from the server -->
        </div>
    </div>
    <div class="section" id="section2">
        <form id="albumForm" onsubmit="createAlbum()">
            <label for="albumTitle">Title:</label>
            <input type="text" id="albumTitle" required />
            <br />
            <button type="submit">Create Album</button>
        </form>
        <button onclick="createUser()">Create new user</button>
        <br /><br />


    </div>
</div>

<script>
    // You can add your JavaScript code here
</script>
<!--<div>-->
<!--    <form id="uploadForm">-->
<!--        <label for="image">Choose an image:</label>-->
<!--        <input type="file" id="image" name="image" accept="image/*" onchange="previewImage()">-->
<!--        <br>-->
<!--        <img id="imagePreview" src="#" alt="Preview" style="max-width: 100%; max-height: 200px; display: none;">-->
<!--        <br>-->
<!--        <input type="submit" value="Upload">-->
<!--    </form>-->


<script>
    let currentUrl = "http://192.168.100.101:8080/";
    let currentAlbum = '';
    let imageObserver;
    document.addEventListener('DOMContentLoaded', function() {
        // Add an event listener to the "Create Album" button
        // Load existing albums on page load
        loadAlbums();
    });

    document.addEventListener('DOMContentLoaded', function(){
        const lazyImages = document.querySelectorAll('.lazy-image');

        const options = {
            root:null,
            rootMargin: '0px',
            threshold: 0.5
        };

        function handleIntersection(entries, observer){
            entries.forEach(entry => {
                if(entry.isIntersecting){
                    loadImage(entry.target);
                    observer.unobserve(entry.target)
                }
            })
        }

        function loadImage(image)
        {
            const src = image.getAttribute('data-src');
            if(src)
            {
                image.src = src;
            }
        }

        imageObserver = new IntersectionObserver(handleIntersection, options);
    })

    function displayAlbumData(album)
    {
        let url = currentUrl + 'adminPanel/album?id=' + album.album_title;
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                displayContent(data);
            })
            .catch(error => alert("Error fetching album data"));
    }
    function loadAlbums(){
        var albumContainer = document.getElementById('albumContainer');
        fetch('/adminPanel?getAlbums')
            .then(response => response.json())
            .then(albums=>{
                albumContainer.innerHTML = '';
                albums.forEach(album => {
                    let albumDiv = document.createElement('div');
                    albumDiv.classList.add('album');
                    albumDiv.addEventListener('click', function() {
                        // Handle the click event (e.g., navigate to a detailed view)
                        currentAlbum = album;
                        displayAlbumData(currentAlbum);
                    });

                    let titleElement = document.createElement('strong');
                    titleElement.textContent = album.album_title + " ";
                    albumDiv.appendChild(titleElement)

                    let usernameElement = document.createElement('strong');
                    usernameElement.textContent = album.username + " ";
                    albumDiv.appendChild(usernameElement)

                    let creationDateElement = document.createElement('strong');
                    creationDateElement.textContent = album.creation_date;
                    albumDiv.appendChild(creationDateElement)
                    albumContainer.appendChild(albumDiv);
                });
            })
    }
    let csrfToken = document.querySelector('meta[name="_csrf"]').content;

    function uploadFile()
    {
        const fileInput = document.getElementById('fileInput');
        for(let i = 0; i < fileInput.files.length;i++)
        {
            const file = fileInput.files[i];
            if(file)
            {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('albumName', currentAlbum.album_title);
                fetch(currentUrl + 'adminPanel?upload',{
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRF-TOKEN': csrfToken,
                    }
                }).then(response => {
                    if(!response.ok){
                        alert("Couldn't upload file")
                    }




                })
            }
        }
        displayAlbumData(currentAlbum);


    }

    function createAlbum()
    {
        let albumTitle = document.getElementById('albumTitle').value;
        if(albumTitle) {
            fetch(currentUrl+ 'adminPanel?createAlbum', {
                method: 'POST',
                body: JSON.stringify({
                    album_title: albumTitle,
                    username: 'root'
                }),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8',
                    'X-CSRF-TOKEN': csrfToken,
                }
            })
                .then(function (response) {
                    window.location.href = response.url;
                })
        }
    }

    function displayContent(contents) {

        const container = document.getElementById('imageContainer');
        container.innerHTML = '';
        contents.forEach(content => {
            if (content.fileType === 'image') {

                const imageItem = document.createElement('div');
                imageItem.classList.add('image-item');
                const imgElement = document.createElement('img');
                imgElement.setAttribute('data-src', currentUrl+'adminPanel/content?id=' + content.fileName);
                imageObserver.observe(imgElement);

                const infoBar = document.createElement('div');
                infoBar.classList.add('image-info-bar')
                infoBar.innerText = content.fileName;

                imageItem.appendChild(imgElement);
                imageItem.appendChild(infoBar);
                container.appendChild(imageItem);


            } else if (content.fileType === 'video') {
                const videoItem = document.createElement('div');
                videoItem.classList.add('image-item');

                const videoElement = document.createElement('video');
                videoElement.src = currentUrl + 'adminPanel/content/' + content.fileName;

                // Append the video element to the video item
                videoItem.appendChild(videoElement);

                // Append the video item to the container
                container.appendChild(videoItem);
            }
        });
    }

</script>
</body>
</html>